# 改造前的需求文档-5.2.2	下单需求

## 5.2.2.1	下单流程

流程说明：
1.	商户请求UMP下单；
1.	UMP校验请求参数，创建订单；
1.	判断订单币种是否为外币，为外币则UMP需要查询交易汇率，计算订单人民币金额；为人民币则跳过此步；
1.	UMP通道路由查询，获得通道属性； 
1.	向商户返回U付订单号及全量支付要素名称；（返回全量，确保UMP能从商户处收集外管局所需的四要素）
1.	商户接收信息。

## 5.2.2.2	业务规则

1.	一个子订单代表商户端的一个商品订单。允许一笔支付订单中包含多个子订单。一个子订单中，应包含一个订单号、一种订单类型、一个子订单金额、一个交易编码和一个交易附言。
1.	货物类的子订单中还需按照货物品类进行划分。一个子订单中，包含多种单品。每种单品对应一个商品编号、一个订单子类型、一个商品金额。（货物类按单品进行分类的原因：外管局客户月报表中要求将货物类别商品细分为四个子类型。）
1.	金额校验：

	（１）订单金额＝各子订单金额之和；
	（２）（货物类）子订单金额＝同一子订单下各商品金额之和。
1.	订单币种为外币时，UMP需根据交易汇率计算订单人民币金额，将交易汇率与订单人民币金额返回给商户。金额用途：

	（１）支付订单中，用户实际应支付的人民币金额；
	（２）扣除手续费后为实时结算到U付的金额；
	（３）清结算时，扣除手续费后为人民币计价商户的应购汇人民币金额。
1.	商户下单后，UMP在返回在获取验证码时应提交的支付要素时，信用卡快捷应返回姓名、身份证号、卡号、手机号、有效期、CVV2，借记卡快捷应返回姓名、身份证号、卡号、手机号。

# 改造后的需求文档-5.2.2	下单需求

**目前的需求还需要补充各交互动作中，商户上传其他哪些信息的说明，这些说明分为两个层面：**

	1. 要能让商户知道正确上传哪些必要的信息可以得到成功的返回，及相关扩展场景下如何上送信息
	2. 需要提供反例，什么情况下会出错，及此场景下商户要做什么

1. 开通后的商户可以[请求UMF下单](payments/CreatePayment.md "c:run")。